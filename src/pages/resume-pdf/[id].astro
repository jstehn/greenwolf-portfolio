---
import { drafts } from "../../data/resumeDrafts";

export function getStaticPaths() {
    return drafts.map((draft) => ({
        params: { id: draft.id },
        props: { draft },
    }));
}

function formatDate(dateStr: string): string {
    const [year, month, day] = dateStr.split("-").map(Number);
    const date = new Date(year, month - 1, day);
    return date.toLocaleDateString("en-US", {
        month: "short",
        year: "numeric",
    });
}

const { draft } = Astro.props;
const { basics: db, work, education } = draft.data as any;
---

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Resume — {db.name}</title>
        <style>
            @page {
                size: letter;
                margin: 0;
            }
            :root {
                --font-sans: "Inter", -apple-system, BlinkMacSystemFont,
                    "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                --color-text: #1a1a1a;
                --color-text-secondary: #4a4a4a;
                --color-text-muted: #71717a;
                --color-accent: #2563eb;
                --color-border: #e4e4e7;
                --space-1: 0.15rem;
                --space-2: 0.25rem;
                --space-3: 0.5rem;
                --space-4: 0.75rem;
                --space-5: 1rem;
                --space-6: 1.5rem;
            }
            body {
                font-family: var(--font-sans);
                color: var(--color-text);
                margin: 0;
                padding: 24px 32px;
                box-sizing: border-box;
                font-size: 9.5pt;
                line-height: 1.35;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .resume-header {
                text-align: center;
                margin-bottom: var(--space-4);
                border-bottom: 2px solid var(--color-accent);
                padding-bottom: var(--space-3);
            }
            .resume-header h1 {
                margin: 0 0 var(--space-1);
                font-size: 20pt;
                color: var(--color-text);
                line-height: 1.1;
            }
            .resume-label {
                margin: 0 0 var(--space-2);
                font-size: 12pt;
                color: var(--color-accent);
                font-weight: 500;
            }
            .resume-contact {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: var(--space-3);
                font-size: 9pt;
                color: var(--color-text-secondary);
            }
            .resume-contact a {
                color: inherit;
                text-decoration: none;
            }
            .resume-contact span::after {
                content: " • ";
                margin-left: var(--space-3);
                color: var(--color-border);
            }
            .resume-contact span:last-child::after {
                content: "";
            }
            .resume-section {
                margin-bottom: var(--space-4);
            }
            .resume-section-title {
                font-size: 12pt;
                font-weight: 700;
                color: var(--color-accent);
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin: 0 0 var(--space-2);
                border-bottom: 1px solid var(--color-border);
                padding-bottom: var(--space-1);
            }
            .resume-summary {
                font-size: 10pt;
                color: var(--color-text-secondary);
                margin: 0;
                line-height: 1.5;
            }
            .timeline-item {
                margin-bottom: var(--space-3);
                page-break-inside: avoid;
            }
            .timeline-header {
                display: flex;
                justify-content: space-between;
                align-items: baseline;
                margin-bottom: 2px;
            }
            .timeline-title {
                font-size: 11pt;
                font-weight: 600;
                margin: 0;
            }
            .timeline-org {
                font-size: 10pt;
                font-weight: 500;
                color: var(--color-text-secondary);
                margin: 0;
            }
            .timeline-date {
                font-size: 9pt;
                color: var(--color-text-muted);
                white-space: nowrap;
            }
            .timeline-highlights {
                list-style-type: disc;
                padding-left: var(--space-4);
                margin: var(--space-1) 0 0 0;
            }
            .timeline-highlights li {
                font-size: 9pt;
                color: var(--color-text-secondary);
                margin-bottom: 2px;
                line-height: 1.35;
            }
            .timeline-highlights li strong {
                color: var(--color-text);
            }
        </style>
    </head>
    <body>
        <div class="resume-header">
            <h1>{db.name}</h1>
            <p class="resume-label">{db.label}</p>
            <div class="resume-contact">
                <span>{db.location.city}, {db.location.region}</span>
                <span>
                    <a href={`mailto:${db.email}`}>{db.email}</a>
                </span>
                {
                    db.profiles.map((profile: any) => (
                        <span>
                            <a href={profile.url}>
                                {profile.network === "html5"
                                    ? profile.username
                                    : profile.url.replace(/^https?:\/\//, "")}
                            </a>
                        </span>
                    ))
                }
            </div>
        </div>

        <div class="resume-section">
            <h2 class="resume-section-title">Professional Summary</h2>
            <p class="resume-summary">{db.summary}</p>
        </div>

        <div class="resume-section">
            <h2 class="resume-section-title">Experience</h2>
            {
                work.map((job: any) => (
                    <div class="timeline-item">
                        <div class="timeline-header">
                            <div>
                                <h3 class="timeline-title">{job.position}</h3>
                                <p class="timeline-org">{job.name}</p>
                            </div>
                            <div class="timeline-date">
                                {formatDate(job.startDate)} —{" "}
                                {job.endDate
                                    ? formatDate(job.endDate)
                                    : "Present"}
                            </div>
                        </div>
                        {job.highlights && (
                            <ul class="timeline-highlights">
                                {job.highlights.map((h: string) => (
                                    <li
                                        set:html={h.replace(
                                            /\*\*(.*?)\*\*/g,
                                            "<strong>$1</strong>"
                                        )}
                                    />
                                ))}
                            </ul>
                        )}
                    </div>
                ))
            }
        </div>

        <div class="resume-section">
            <h2 class="resume-section-title">Education</h2>
            {
                education.map((edu: any) => (
                    <div class="timeline-item">
                        <div class="timeline-header">
                            <div>
                                <h3 class="timeline-title">
                                    {edu.institution}
                                </h3>
                                <p class="timeline-org">
                                    {edu.studyType} in {edu.area}
                                </p>
                                {edu.gpa && (
                                    <p style="margin: 4px 0 0; font-size: 10pt; color: var(--color-text-secondary); font-style: italic;">
                                        GPA: {edu.gpa}
                                    </p>
                                )}
                            </div>
                            <div class="timeline-date">
                                {formatDate(edu.startDate)} —{" "}
                                {formatDate(edu.endDate)}
                            </div>
                        </div>
                        {edu.summary && (
                            <p style="margin: 4px 0 0; font-size: 10pt; color: var(--color-text-secondary);">
                                {edu.summary}
                            </p>
                        )}
                    </div>
                ))
            }
        </div>
    </body>
</html>
