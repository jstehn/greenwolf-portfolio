---
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import TagFilter from "../../components/TagFilter.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Collect all unique tags from posts
const allTags = [...new Set(posts.flatMap((p) => p.data.tags || []))].sort();
---

<BaseLayout
	title="Blog â€” Jack Stehn"
	description="Thoughts, tutorials, and learnings from Jack Stehn."
>
	<section class="blog-page">
		<div class="section-header">
			<h1 class="section-title">Blog</h1>
			<p class="section-subtitle">Thoughts, tutorials, and learnings</p>
		</div>

		{
			allTags.length > 0 && (
				<TagFilter tags={allTags} targetSelector=".blog-card" />
			)
		}

		<div class="blog-grid">
			{
				posts.map((post) => (
					<a
						href={`/blog/${post.id}/`}
						class="blog-card card"
						data-tags={(post.data.tags || [])
							.map((t: string) => t.toLowerCase())
							.join(",")}
					>
						<div class="blog-card-content">
							<div class="blog-meta">
								<FormattedDate date={post.data.pubDate} />
								{post.data.tags && post.data.tags.length > 0 && (
									<div class="blog-tags">
										{post.data.tags
											.slice(0, 3)
											.map((tag: string) => (
												<span class="tag">{tag}</span>
											))}
									</div>
								)}
							</div>
							<h3 class="blog-title">{post.data.title}</h3>
							<p class="blog-desc">{post.data.description}</p>
						</div>
					</a>
				))
			}
		</div>
	</section>
</BaseLayout>

<style>
	.blog-page {
		max-width: var(--max-width);
		margin: 0 auto;
	}

	.blog-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
		gap: var(--space-6);
	}

	.blog-card {
		text-decoration: none;
		display: flex;
		flex-direction: column;
	}

	.blog-card-content {
		display: flex;
		flex-direction: column;
		gap: var(--space-3);
	}

	.blog-meta {
		display: flex;
		align-items: center;
		gap: var(--space-3);
		font-size: var(--text-sm);
		color: var(--color-text-muted);
	}

	.blog-tags {
		display: flex;
		gap: var(--space-1);
	}

	.blog-title {
		font-size: var(--text-xl);
		font-weight: 600;
		margin: 0;
		color: var(--color-text);
		transition: color var(--transition-fast);
		line-height: 1.3;
	}

	.blog-card:hover .blog-title {
		color: var(--color-accent);
	}

	.blog-desc {
		font-size: var(--text-sm);
		color: var(--color-text-secondary);
		margin: 0;
		line-height: 1.6;
	}

	@media (max-width: 768px) {
		.blog-grid {
			grid-template-columns: 1fr;
		}
	}
</style>
